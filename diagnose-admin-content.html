<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Diagn√≥stico de Admin Content</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .diagnostic-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        .diagnostic-section h3 {
            margin-top: 0;
            color: #007bff;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .log-entry {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        .log-entry.success {
            background: #d4edda;
            color: #155724;
        }
        .log-entry.error {
            background: #f8d7da;
            color: #721c24;
        }
        .log-entry.warning {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Diagn√≥stico de Admin Content</h1>

        <div class="diagnostic-section">
            <h3>üìä Estado Actual</h3>
            <div id="currentStatus" class="status info">
                Iniciando diagn√≥stico...
            </div>
            <button onclick="runDiagnostic()">üîç Ejecutar Diagn√≥stico</button>
            <button onclick="clearLogs()">üóëÔ∏è Limpiar Logs</button>
        </div>

        <div class="diagnostic-section">
            <h3>üìù Logs de Diagn√≥stico</h3>
            <div id="diagnosticLogs"></div>
        </div>

        <div class="diagnostic-section">
            <h3>üõ†Ô∏è Acciones de Soluci√≥n</h3>
            <button onclick="testDocumentService()">üß™ Probar Document Service</button>
            <button onclick="loadSampleData()">üìÑ Cargar Datos de Prueba</button>
            <button onclick="clearAuthAndReload()" class="danger">üîÑ Limpiar Auth y Recargar</button>
            <button onclick="goToAdminContent()">üìã Ir a Admin Content</button>
        </div>

        <div class="diagnostic-section">
            <h3>üìã Informaci√≥n del Sistema</h3>
            <div id="systemInfo"></div>
        </div>
    </div>

    <script>
        let logs = [];

        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                type,
                message,
                timestamp
            };
            logs.push(logEntry);
            updateLogDisplay();
        }

        function updateLogDisplay() {
            const logsContainer = document.getElementById('diagnosticLogs');
            logsContainer.innerHTML = logs.map(log =>
                `<div class="log-entry ${log.type}">[${log.timestamp}] ${log.message}</div>`
            ).join('');
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        function clearLogs() {
            logs = [];
            updateLogDisplay();
            addLog('info', 'Logs limpiados');
        }

        async function runDiagnostic() {
            addLog('info', 'üîç Iniciando diagn√≥stico completo...');

            // Verificar localStorage
            const accessToken = localStorage.getItem('accessToken');
            const refreshToken = localStorage.getItem('refreshToken');
            const user = localStorage.getItem('user');

            addLog('info', `Access Token: ${accessToken ? 'Presente' : 'Ausente'}`);
            addLog('info', `Refresh Token: ${refreshToken ? 'Presente' : 'Ausente'}`);
            addLog('info', `Usuario: ${user ? 'Presente' : 'Ausente'}`);

            // Verificar si estamos en la p√°gina correcta
            if (window.location.pathname.includes('/admin/content')) {
                addLog('success', '‚úÖ Estamos en la p√°gina correcta: /admin/content');
            } else {
                addLog('warning', '‚ö†Ô∏è No estamos en /admin/content, estamos en: ' + window.location.pathname);
            }

            // Verificar si Vue est√° cargado
            if (window.Vue) {
                addLog('success', '‚úÖ Vue est√° cargado');
            } else {
                addLog('error', '‚ùå Vue no est√° cargado');
            }

            // Verificar si hay errores en la consola
            const originalError = console.error;
            const errors = [];
            console.error = function(...args) {
                errors.push(args.join(' '));
                originalError.apply(console, args);
            };

            setTimeout(() => {
                console.error = originalError;
                if (errors.length > 0) {
                    addLog('warning', `‚ö†Ô∏è Se detectaron ${errors.length} errores en la consola`);
                    errors.forEach(error => addLog('error', `Error: ${error}`));
                } else {
                    addLog('success', '‚úÖ No se detectaron errores en la consola');
                }
            }, 2000);

            // Verificar elementos del DOM
            const adminContent = document.querySelector('[data-testid="admin-content"]') ||
                               document.querySelector('.admin-content') ||
                               document.querySelector('#admin-content');

            if (adminContent) {
                addLog('success', '‚úÖ Elemento admin-content encontrado en el DOM');
            } else {
                addLog('error', '‚ùå Elemento admin-content no encontrado en el DOM');
            }

            // Verificar si hay datos cargados
            const dataElements = document.querySelectorAll('[data-document]');
            if (dataElements.length > 0) {
                addLog('success', `‚úÖ Se encontraron ${dataElements.length} elementos de datos`);
            } else {
                addLog('warning', '‚ö†Ô∏è No se encontraron elementos de datos');
            }

            addLog('info', 'üèÅ Diagn√≥stico completado');
        }

        async function testDocumentService() {
            addLog('info', 'üß™ Probando Document Service...');

            try {
                // Simular llamada al servicio
                const response = await fetch('/api/documentos', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    addLog('success', `‚úÖ Document Service responde correctamente: ${data.length} documentos`);
                } else {
                    addLog('error', `‚ùå Document Service error: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                addLog('error', `‚ùå Error probando Document Service: ${error.message}`);
            }
        }

        function loadSampleData() {
            addLog('info', 'üìÑ Cargando datos de prueba...');

            const sampleData = [
                {
                    id: 1,
                    name: 'Reglamento de Estudiantes',
                    type: 'TEXT',
                    folder: 'reglamentos',
                    content: '# Reglamento de Estudiantes',
                    status: 'Publicado',
                    author: 'Admin Principal',
                    createdAt: '2025-01-10T10:00:00Z',
                    updatedAt: '2025-01-10T15:30:00Z',
                },
                {
                    id: 2,
                    name: 'Manual de Usuario',
                    type: 'TEXT',
                    folder: 'manuales',
                    content: '# Manual de Usuario',
                    status: 'Publicado',
                    author: 'Editor T√©cnico',
                    createdAt: '2025-01-11T14:30:00Z',
                    updatedAt: '2025-01-11T16:45:00Z',
                }
            ];

            // Simular carga de datos
            localStorage.setItem('sampleDocuments', JSON.stringify(sampleData));
            addLog('success', `‚úÖ Datos de prueba cargados: ${sampleData.length} documentos`);
        }

        function clearAuthAndReload() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar la autenticaci√≥n y recargar?')) {
                addLog('info', 'üîÑ Limpiando autenticaci√≥n...');
                localStorage.removeItem('accessToken');
                localStorage.removeItem('refreshToken');
                localStorage.removeItem('user');
                localStorage.removeItem('menus');
                sessionStorage.clear();

                addLog('success', '‚úÖ Autenticaci√≥n limpiada');
                addLog('info', 'üîÑ Recargando p√°gina...');

                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }

        function goToAdminContent() {
            addLog('info', 'üìã Navegando a Admin Content...');
            window.location.href = '/admin/content';
        }

        function updateSystemInfo() {
            const systemInfo = document.getElementById('systemInfo');
            systemInfo.innerHTML = `
                <div class="code-block">
                    <strong>Informaci√≥n del Sistema:</strong><br>
                    URL Actual: ${window.location.href}<br>
                    User Agent: ${navigator.userAgent}<br>
                    Timestamp: ${new Date().toLocaleString()}<br>
                    Local Storage Keys: ${Object.keys(localStorage).join(', ')}<br>
                    Session Storage Keys: ${Object.keys(sessionStorage).join(', ')}
                </div>
            `;
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            addLog('info', 'üöÄ Diagn√≥stico iniciado');
            updateSystemInfo();
            runDiagnostic();
        });
    </script>
</body>
</html>
